---
title: "Mapeando estacionamientos (no construidos)"
author: "Martin Olmos"
date: "2017-10-31T21:48:51-07:00"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Aquí voy a compartir el código para la visualización que acompañó [éste][1] artículo de [Juan Pablo Pilatti][2], del [Instituto iCiudad][3] donde utilizamos Shiny y Leaflet para hacer un mapa interactivo de los estacionamientos aprobados por la Legislatura pero nunca construidos por el Ejecutivo.

```{r, message=FALSE, comment=FALSE, eval=FALSE}

library(shiny)
library(leaflet)
library(sp)
library(sf)
library(rgdal)

# Define la interfaz de usuario
ui <- shinyUI(
        # fluidPage es un layout común de Shiny
        fluidPage(
        
        # Título principal
        titlePanel("Estacionamientos Aprobados por Ley"),
        
        # Situa el mapa de leaflet en el panel principal
        mainPanel(leafletOutput("map", width = 800, height = 800))
        
))

# Define la función en el servidor
server <- function(input, output) {
   
        # Descarga los datos
        estac_sf <-  read.csv("https://github.com/martinolmos/estacionamientos/raw/master/estac_sf.csv")
        # Transforma los datos en un objeto espacial
        estac_sp <- SpatialPointsDataFrame(coords = estac_sf[,1:2], 
                                           data = estac_sf,
                                           proj4string = CRS("+proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0"))
        
        # Define los íconos a utilizar en el mapa
        icons <- awesomeIcons(
                icon = 'ios-close-circled',
                iconColor = 'black',
                library = 'ion',
                markerColor = ifelse(estac_sp@data$const == 'NO', 'red', 'green'))
        
        # Define el mapa
        output$map <- renderLeaflet({
                
                # Crea el mapa
                leaflet() %>% 
                addTiles() %>%
                        
                # Fija los límites
                fitBounds(lat1 = -34.69029, 
                          lng1 = -58.48664, 
                          lat2 = -34.55579, 
                          lng2 = -58.3694) %>%
                        
                        # Agrega la leyenda
                addLegend(position = "topleft", 
                          title = "Estacionamiento Construido",
                          pal = colorFactor(palette = c('red', 'green'), 
                                            levels = levels(as.factor(estac_sf$const))), 
                          values = c("NO", "SI")) %>%
                addAwesomeMarkers(data = estac_sp, 
                                  icon = icons, 
                                  label = ~nombre,
                                  popup = ~norma)

                })
}

# Corre la app 
shinyApp(ui = ui, server = server)

```

<iframe src="https://martinolmos.shinyapps.io/estaciona2/" style="border: none; width: 900px; height: 900px"></iframe>


[1]:(http://www.iciudad.org.ar/estacionar-en-la-ciudad-mision-imposible/)
[2]:(https://twitter.com/juanpilatti?lang=es)
[3]:(http://www.iciudad.org.ar/)
